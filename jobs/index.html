<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Stanislav BÃ¶hm">
  <link rel="canonical" href="https://it4innovations.github.io/hyperqueue/jobs/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Jobs (Basics) - HyperQueue</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Jobs (Basics)";
    var mkdocs_page_input_path = "jobs.md";
    var mkdocs_page_url = "/hyperqueue/jobs/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TM8J8R5GJ9"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'G-TM8J8R5GJ9');
</script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> HyperQueue</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../install/">Installation</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../cheatsheet/">Cheatsheet</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../deployment/">Deployment</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Jobs (Basics)</a>
    <ul class="current">
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../arrays/">Task Arrays</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../cpus/">CPU management</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../streaming/">Streaming stdio/stderr</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../alloc/">Automatic allocation</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">HyperQueue</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Jobs (Basics)</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/It4innovations/hyperqueue/blob/main/docs/jobs.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="jobs">Jobs<a class="headerlink" href="#jobs" title="Permanent link">#</a></h1>
<p>A <em>job</em> is a portion of work that can be submitted into a HyperQueue.</p>
<p>Each job may have one or <em>tasks</em>. In the current version, a is a single execution of a program.</p>
<p><strong>In this section, we are introducing simple jobs, where each job has exactly one tasks.</strong>
See section about Job arrays for submitting more tasks in one job.</p>
<h1 id="identification-numbers">Identification numbers<a class="headerlink" href="#identification-numbers" title="Permanent link">#</a></h1>
<p>Each job is identified by a positive integer that is assigned by HyperQueue server when the job is submitted, we refer to it as <em>job id</em>.</p>
<p>Each task is identified by an unsigned 32b integer called <em>task id</em>. Task id can be assigned by a user and same task id may be used in two different jobs.</p>
<p>In simple jobs, task id is set to 0.</p>
<h2 id="submitting-jobs">Submitting jobs<a class="headerlink" href="#submitting-jobs" title="Permanent link">#</a></h2>
<p><code>hq submit &lt;program&gt; &lt;args1&gt; ...</code></p>
<p>HyperQueue assigns a unique job id when a job is submitted.</p>
<p>When your command contains its own switches, you need to use <code>--</code> after submit:</p>
<p><code>hq submit -- /bin/bash -c 'echo $PPID'</code></p>
<h3 id="name-of-a-job">Name of a job<a class="headerlink" href="#name-of-a-job" title="Permanent link">#</a></h3>
<p>Each job has an assigned name. It has only an informative character for the user. By default, the name is extracted from
the job's program name. You can set a job name explicitly by:</p>
<p><code>hq submit --name=&lt;NAME&gt; ...</code></p>
<h3 id="working-directory-of-a-job">Working directory of a job<a class="headerlink" href="#working-directory-of-a-job" title="Permanent link">#</a></h3>
<p>You can change the working directory of a job using the <code>--cwd</code> parameter. By default it is set to the directory
from which was the job submitted.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>You can use <a href="#placeholders">placeholders</a> in the working directory path.</p>
</div>
<h3 id="output-of-the-job">Output of the job<a class="headerlink" href="#output-of-the-job" title="Permanent link">#</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you want to avoid creating many files, see the section about streaming</p>
</div>
<p>By default, each job will produce two files containing the standard output and standard error output, respectively.</p>
<p>The paths where these files will be created can be changed via the parameters <code>--stdout=&lt;path&gt;</code> and <code>--stderr=&lt;path&gt;</code>.
You can also disable creating stdout/stderr completely by setting value <code>none</code>.</p>
<pre><code class="language-bash">$ hq submit --stdout=none ...
</code></pre>
<p>The default values for these paths are <code>job-%{JOB_ID}/%{TASK_ID}.stdout</code> and <code>job-%{JOB_ID}/%{TASK_ID}.stderr</code>. You can read
about the <code>%{JOB_ID}</code> and <code>%{TASK_ID}</code> placeholders <a href="#placeholders">below</a>.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>You can use <a href="#placeholders">placeholders</a> in the <code>stdout</code> and <code>stderr</code> paths.</p>
</div>
<h2 id="placeholders">Placeholders<a class="headerlink" href="#placeholders" title="Permanent link">#</a></h2>
<p>You can use special variables in working directory, <code>stdout</code> and <code>stderr</code> paths, which will be interpolated with
job/task-specific information before the job is executed. Placeholders are enclosed in curly braces and prepended with
a percent sign.</p>
<p>Currently, you can use the following placeholders:</p>
<table>
<thead>
<tr>
<th>Placeholder</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>%{JOB_ID}</code></td>
<td>Job ID.</td>
</tr>
<tr>
<td><code>%{TASK_ID}</code></td>
<td>Task ID.</td>
</tr>
<tr>
<td><code>%{INSTANCE_ID}</code></td>
<td>Instance ID (see below)</td>
</tr>
<tr>
<td><code>%{SUBMIT_DIR}</code></td>
<td>Directory from which the job was submitted.</td>
</tr>
<tr>
<td><code>%{CWD}</code></td>
<td>Working directory of the job.<br/><br/>This placeholder is only available for <code>stdout</code> and <code>stderr</code> paths.</td>
</tr>
<tr>
<td><code>%{DATE}</code></td>
<td>Current date when the job was executed in the RFC3339 format.</td>
</tr>
</tbody>
</table>
<h2 id="setting-env-variables">Setting env variables<a class="headerlink" href="#setting-env-variables" title="Permanent link">#</a></h2>
<p>In a submit of a task, you can set an environment variable named <code>KEY</code> with the value <code>VAL</code> by:</p>
<p><code>--env KEY=VAL</code></p>
<p>You can pass the following flag multiple times to pass multiple variables.</p>
<h2 id="information-about-jobs">Information about jobs<a class="headerlink" href="#information-about-jobs" title="Permanent link">#</a></h2>
<p>List of all jobs:</p>
<p><code>hq jobs</code></p>
<p>List of jobs in a defined state:</p>
<p><code>hq jobs &lt;filters...&gt;</code></p>
<p>Where filters can be: <code>waiting</code>, <code>running</code>, <code>finished</code>, <code>failed</code>, or <code>canceled</code>.</p>
<p>Detailed information about a job:</p>
<p><code>hq job &lt;job-id&gt;</code></p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>You can also use <code>hq job last</code> to get information about the most recently submitted job.</p>
</div>
<h2 id="task-states">Task states<a class="headerlink" href="#task-states" title="Permanent link">#</a></h2>
<pre><code>Submitted
   |
   |
   v
Waiting-----------------\
   | ^                  |
   | |                  |
   v |                  |
Running-----------------|
   | |                  |
   | \--------\         |
   |          |         |
   v          v         v
Finished    Failed   Canceled
</code></pre>
<ul>
<li><em>Submitted</em> - Only an informative state that a submission was successful; it is only shown immediately after a submit.</li>
<li><em>Waiting</em> - The task is waiting to be executed.</li>
<li><em>Running</em> - The task is running in a worker. It may become "waiting" again when a worker (where the task is running) is lost.</li>
<li><em>Finished</em> - The task has successfully finished.</li>
<li><em>Failed</em> - The task has failed. The error can be shown by <code>hq job &lt;job-id&gt;</code>.</li>
<li><em>Canceled</em> -  The task has been canceled by a user.</li>
</ul>
<h2 id="time-management">Time management<a class="headerlink" href="#time-management" title="Permanent link">#</a></h2>
<p>Time management is split into two settings:</p>
<ul>
<li><strong>time limit</strong> - It is the maximal running time of a task.
               If it is reached then task is terminated and set into FAILED state.
               This setting does not have any impact on scheduling.</li>
<li><strong>time request</strong> - The minimal remaining lifetime of a worker needed to start the task.
                     Workers that do not have enough remaining lifetime will not be scheduled to run this task.
                     Once the task is scheduled and starts executing, it does not matter w.r.t this setting for how long it will actually run.
                     Workers without known remaining lifetime is always assumed that it may execute any time request. </li>
</ul>
<p>We have separated these settings to solve the following scenario. Lets us assume that we have a collection of task
where the vast majority of tasks usually finish within 10 minutes but some of them run 30 minutes. We do not know in advance which tasks are slow.
In this situation, we want to set the time limit to 35 minutes
to protect us against an error. However, we want to schedule the task to worker as long as it has at least 10 minutes of lifetime despite
we are risking of rare losing some computation time when worker dies before the computation is finished. 
(Note that in this situation, a task is rescheduled to another worker; we have only lost some computational power and not the whole task.)</p>
<h3 id="time-limit">Time limit<a class="headerlink" href="#time-limit" title="Permanent link">#</a></h3>
<p>Time limit is set as follows:</p>
<p><code>hq submit --time-limit=TIME ...</code></p>
<p>Where <code>TIME</code> is a number followed by units (e.g. <code>10 min</code>)</p>
<h3 id="time-request">Time request<a class="headerlink" href="#time-request" title="Permanent link">#</a></h3>
<p>Time request is set as follows:</p>
<p><code>hq submit --time-request=TIME</code></p>
<h3 id="time-units">Time Units<a class="headerlink" href="#time-units" title="Permanent link">#</a></h3>
<p>You can use the following units:</p>
<ul>
<li>msec, ms -- milliseconds</li>
<li>seconds, second, sec, s</li>
<li>minutes, minute, min, m</li>
<li>hours, hour, hr, h</li>
<li>days, day, d</li>
<li>weeks, week, w</li>
<li>months, month, M -- defined as 30.44 days</li>
<li>years, year, y -- defined as 365.25 days</li>
</ul>
<p>Time can be also a combination of more units:</p>
<p><code>hq submit --time-limit="1h 30min" ...</code></p>
<h2 id="task-instance">Task instance<a class="headerlink" href="#task-instance" title="Permanent link">#</a></h2>
<p>It may happen that a task is started more than once when a worker crashes during execution of a task and the task is rescheduled to another worker. Instance IDs exist to distinguish each run when necessary. Instance ID is 32b non-negative number and it is guarantted that the newer execution has a bigger value. HyperQueue explicitly does <em>not</em> guarantee any specific value or differences between two ids. Instance ID is valid only for a particular task. Two different tasks may have the same instance ID.</p>
<h2 id="job-states">Job states<a class="headerlink" href="#job-states" title="Permanent link">#</a></h2>
<p>In simple jobs, job state corresponds directly to the state of its single task. In the case of task arrays, see the chapter
about <a href="../arrays/">task arrays</a>.</p>
<h2 id="canceling-jobs">Canceling jobs<a class="headerlink" href="#canceling-jobs" title="Permanent link">#</a></h2>
<p>A job cannot be canceled if it is already finished, failed, or canceled.</p>
<ul>
<li>Cancel specific job:</li>
</ul>
<p><code>hq cancel &lt;job-id&gt;</code></p>
<ul>
<li>Cancel all jobs:</li>
</ul>
<p><code>hq cancel all</code></p>
<ul>
<li>Cancel last submitted job:</li>
</ul>
<p><code>hq cancel last</code></p>
<h2 id="waiting-for-jobs">Waiting for jobs<a class="headerlink" href="#waiting-for-jobs" title="Permanent link">#</a></h2>
<p>You can submit a job with flag <code>--wait</code> and HQ will wait until the submitted job is not terminated (until all tasks are either finished, failed or canceled).</p>
<p>You can also use <code>hq wait &lt;job-id&gt;</code> to wait for a specific job or <code>hq wait last</code> to wait for the last submitted job or <code>hq wait all</code> to wait for all jobs.</p>
<p>If you want to interactively observe the status of the jobs while waiting for them to finish, use <code>hq submit --progress</code>
or <code>hq progress &lt;job-id&gt;</code> instead.</p>
<h2 id="priorities">Priorities<a class="headerlink" href="#priorities" title="Permanent link">#</a></h2>
<p>Priorities affect the order in which the "waiting" tasks are executed. Priority can be any 32b <em>signed</em> integer. A lowest number marks the lowest priority, e.g. when task A with priority 5 and task B with priority 3 are scheduled to the same worker, and only one of them may be executed, then A will be executed first.</p>
<p>In a submit of a task, you can set priority as follows</p>
<p><code>hq submit --priority=&lt;PRIORITY&gt;</code></p>
<p>If no priority is specified, then task has priority 0.</p>
<h2 id="resubmit">Resubmit<a class="headerlink" href="#resubmit" title="Permanent link">#</a></h2>
<p>If you want to recompute a previous job, jou can use:</p>
<p><code>hq resubmit &lt;job-id&gt;</code></p>
<p>that creates a new job with the exact the same configuration as the source job.</p>
<p>By default, it submits all tasks of the original job; however, you can specify only a subset of tasks, e.g.</p>
<p><code>hq resubmit &lt;job-id&gt; --status=failed,canceled</code></p>
<p>Resubmits only tasks that failed or were canceled.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../arrays/" class="btn btn-neutral float-right" title="Task Arrays">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../deployment/" class="btn btn-neutral" title="Deployment"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/It4innovations/hyperqueue/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../deployment/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../arrays/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
