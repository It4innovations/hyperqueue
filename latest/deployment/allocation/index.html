<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation of HyperQueue."><meta name=author content="Stanislav BÃ¶hm"><link href=https://it4innovations.github.io/hyperqueue/stable/deployment/allocation/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-7.3.2"><title>Automatic Allocation - HyperQueue</title><link rel=stylesheet href=../../assets/stylesheets/main.24c991ad.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TM8J8R5GJ9"),document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof location$&&location$.subscribe(function(t){gtag("config","G-TM8J8R5GJ9",{page_path:t.pathname})})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TM8J8R5GJ9"></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#allocation-queue class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=HyperQueue class="md-header__button md-logo" aria-label=HyperQueue data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> HyperQueue </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Automatic Allocation </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/It4innovations/hyperqueue/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=HyperQueue class="md-nav__button md-logo" aria-label=HyperQueue data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> HyperQueue </label> <div class=md-nav__source> <a href=https://github.com/It4innovations/hyperqueue/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../installation/ class=md-nav__link> Installation </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../quickstart/ class=md-nav__link> Quickstart </a> </li> <li class=md-nav__item> <a href=../../cheatsheet/ class=md-nav__link> Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Deployment <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Deployment data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Deployment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> Architecture </a> </li> <li class=md-nav__item> <a href=../server/ class=md-nav__link> Server </a> </li> <li class=md-nav__item> <a href=../worker/ class=md-nav__link> Workers </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Automatic Allocation <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Automatic Allocation </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#allocation-queue class=md-nav__link> Allocation queue </a> <nav class=md-nav aria-label="Allocation queue"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parameters class=md-nav__link> Parameters </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#behavior class=md-nav__link> Behavior </a> </li> <li class=md-nav__item> <a href=#stopping-automatic-allocation class=md-nav__link> Stopping automatic allocation </a> </li> <li class=md-nav__item> <a href=#debugging-automatic-allocation class=md-nav__link> Debugging automatic allocation </a> <nav class=md-nav aria-label="Debugging automatic allocation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dry-run-command class=md-nav__link> Dry-run command </a> </li> <li class=md-nav__item> <a href=#finding-information-about-allocations class=md-nav__link> Finding information about allocations </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#useful-autoalloc-commands class=md-nav__link> Useful autoalloc commands </a> <nav class=md-nav aria-label="Useful autoalloc commands"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#display-a-list-of-all-allocation-queues class=md-nav__link> Display a list of all allocation queues </a> </li> <li class=md-nav__item> <a href=#display-information-about-an-allocation-queue class=md-nav__link> Display information about an allocation queue </a> </li> <li class=md-nav__item> <a href=#display-events-of-an-allocation-queue class=md-nav__link> Display events of an allocation queue </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Task computation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Task computation" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Task computation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jobs/jobs/ class=md-nav__link> Jobs and Tasks </a> </li> <li class=md-nav__item> <a href=../../jobs/arrays/ class=md-nav__link> Task Arrays </a> </li> <li class=md-nav__item> <a href=../../jobs/cresources/ class=md-nav__link> CPU Resources </a> </li> <li class=md-nav__item> <a href=../../jobs/gresources/ class=md-nav__link> Generic Resources </a> </li> <li class=md-nav__item> <a href=../../jobs/failure/ class=md-nav__link> Handling Failure </a> </li> <li class=md-nav__item> <a href=../../jobs/streaming/ class=md-nav__link> Output Streaming </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Tips <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tips data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Tips </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tips/cli-shortcuts/ class=md-nav__link> CLI Shortcuts </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../../other-tools/ class=md-nav__link> Comparison With Other Tools </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#allocation-queue class=md-nav__link> Allocation queue </a> <nav class=md-nav aria-label="Allocation queue"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parameters class=md-nav__link> Parameters </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#behavior class=md-nav__link> Behavior </a> </li> <li class=md-nav__item> <a href=#stopping-automatic-allocation class=md-nav__link> Stopping automatic allocation </a> </li> <li class=md-nav__item> <a href=#debugging-automatic-allocation class=md-nav__link> Debugging automatic allocation </a> <nav class=md-nav aria-label="Debugging automatic allocation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dry-run-command class=md-nav__link> Dry-run command </a> </li> <li class=md-nav__item> <a href=#finding-information-about-allocations class=md-nav__link> Finding information about allocations </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#useful-autoalloc-commands class=md-nav__link> Useful autoalloc commands </a> <nav class=md-nav aria-label="Useful autoalloc commands"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#display-a-list-of-all-allocation-queues class=md-nav__link> Display a list of all allocation queues </a> </li> <li class=md-nav__item> <a href=#display-information-about-an-allocation-queue class=md-nav__link> Display information about an allocation queue </a> </li> <li class=md-nav__item> <a href=#display-events-of-an-allocation-queue class=md-nav__link> Display events of an allocation queue </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/It4innovations/hyperqueue/blob/main/docs/deployment/allocation.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>Automatic Allocation</h1> <p><strong>Automatic allocation</strong> is one of the core features of HyperQueue. When you run HyperQueue on an HPC cluster, it allows you to autonomously ask the job manager (PBS/Slurm) for computing resources and spawn HyperQueue <a href=../worker/ >workers</a> on the provided nodes.</p> <p>Using this mechanism, you can submit computations into HyperQueue without caring about the underlying PBS/Slurm jobs.</p> <div class="admonition note"> <p class=admonition-title>Job terminology</p> <p>It is common to use the term "job" for jobs created by an HPC job manager, such as PBS or Slurm, which are used to perform computations on HPC clusters. However, HyperQueue also uses the term "job" for <a href=../../jobs/jobs/ >ensembles of tasks</a>.</p> <p>To differentiate between these two, we will refer to jobs created by PBS or Slurm as <code>allocations</code>. We will also refer to PBS/Slurm as a <code>job manager</code>.</p> </div> <h2 id=allocation-queue>Allocation queue<a class=headerlink href=#allocation-queue title="Permanent link">#</a></h2> <p>To enable automatic allocation, you have to create an <code>Allocation queue</code>. It describes a specific configuration that will be used by HyperQueue to request computing resources from the job manager on your behalf.</p> <p>Each allocation queue has a set of <a href=#parameters>parameters</a>. You can use them to modify the behavior of automatic allocation, but for start you can simply use the defaults. However, you will almost certainly need to specify some credentials to be able to ask for computing resources using PBS/Slurm.</p> <p>To create a new allocation queue, use the following command and pass any required credentials (queue/partition name, account ID, etc.) after <code>--</code>. These trailing arguments will then be passed directly to <code>qsub</code>/<code>sbatch</code>:</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>PBS</label><label for=__tabbed_1_2>Slurm</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$ hq alloc add pbs --time-limit 1h -- -qqprod -AAccount1
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$ hq alloc add slurm --time-limit 1h -- --partition<span class=o>=</span>p1
</code></pre></div> </div> </div> </div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Make sure that a HyperQueue server is running when you execute this command. Allocation queues are not persistent, so you have to set them up each time you (re)start the server.</p> </div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Do not pass the number of nodes that should be allocated or the allocation walltime using these trailing arguments. These parameters are configured using other means, see <a href=#parameters>below</a>.</p> </div> <p>Once the queue is created, HyperQueue will start asking for allocations in order to provide computing resources (HyperQueue workers). The exact behavior of the automatic allocation process is described <a href=#behavior>below</a>. You can create multiple allocation queues, and you can even combine PBS queues with Slurm queues.</p> <h3 id=parameters>Parameters<a class=headerlink href=#parameters title="Permanent link">#</a></h3> <p>In addition to arguments that are passed to <code>qsub</code>/<code>sbatch</code>, you can also use several other command line options when creating a new allocation queue:</p> <ul> <li> <p><strong><code>--time-limit &lt;duration&gt;</code></strong> Sets the walltime of created allocations<sup id=fnref:1><a class=footnote-ref href=#fn:1>1</a></sup>.</p> <p>This parameter is required, as HyperQueue must know the duration of the individual allocations. Make sure that you pass a time limit that does not exceed the limit of the PBS/Slurm queue that you intend to use, otherwise the allocation submissions will fail. You can use the <a href=#dry-run-command><code>dry-run</code> command</a> to debug this.</p> </li> <li> <p><code>--backlog &lt;count&gt;</code> How many allocations should be queued (waiting to be started) in PBS/Slurm at any given time.</p> </li> <li><code>--workers-per-alloc &lt;count&gt;</code> How many nodes should be requested in each allocation.</li> <li><code>--name &lt;name&gt;</code> Name of the allocation queue. Will be used to name allocations. Serves for debug purposes only.</li> <li> <p><strong>Worker resources</strong> You can specify <a href=../../jobs/cresources/ >CPU</a> and <a href=../../jobs/gresources/ >generic</a> resources of workers spawned in the created allocation queue. The name and syntax of these parameters is the same as when you create a worker manually:</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>PBS</label><label for=__tabbed_2_2>Slurm</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$ hq alloc add pbs --time-limit 1h --cpus 4x4 --resource <span class=s2>&quot;gpu=indices(1-2)&quot;</span> -- -qqprod -AAccount1
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$ hq alloc add slurm --time-limit 1h --cpus 4x4 --resource <span class=s2>&quot;gpu=indices(1-2)&quot;</span> -- --partition<span class=o>=</span>p1
</code></pre></div> </div> </div> </div> <p>If you do not pass any resources, they will be detected automatically (same as it works with <code>hq worker start</code>).</p> </li> </ul> <h2 id=behavior>Behavior<a class=headerlink href=#behavior title="Permanent link">#</a></h2> <p>The automatic allocator is a periodic process that runs every few seconds and does the following:</p> <ol> <li> <p>If there are no waiting tasks in HQ, it immediately ends. This avoids queuing allocations if there is nothing to compute.</p> </li> <li> <p>Otherwise, the allocator queues new allocations to make sure that there are is a specific number of allocations waiting to be started by the job manager. This number is called <strong>backlog</strong> and you can <a href=#parameters>set it</a> when creating the queue.</p> <p>For example, if <strong>backlog</strong> was set to <code>4</code> and there is currently only one allocation queued into the job manager, the allocator would queue three more allocations.</p> <p>The backlog serves to pre-queue allocations, because it can take some time before the job manager starts them, and also as a load balancing factor, since it will allocate as many resources as the job manager allows.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The <strong>backlog</strong> value does not limit the number of running allocations, only the number of queued allocations.</p> </div> </li> <li> <p>When an allocation starts, a HyperQueue <a href=../worker/ >worker</a> will start and connect to the HyperQueue server that queued the allocation. The worker has the <a href=../worker/#idle-timeout>idle timeout</a> set to five minutes, therefore it will terminate if it doesn't receive any new tasks for five minutes.</p> </li> </ol> <h2 id=stopping-automatic-allocation>Stopping automatic allocation<a class=headerlink href=#stopping-automatic-allocation title="Permanent link">#</a></h2> <p>If you want to remove an allocation queue, use the following command:</p> <div class=highlight><pre><span></span><code>$ hq alloc remove &lt;queue-id&gt;
</code></pre></div> <p>When an allocation queue is removed, all its corresponding queued and running allocations will be canceled immediately.</p> <p>By default, HQ will not allow you to remove an allocation queue that contains a running allocation. If you want to force its removal, use the <code>--force</code> flag.</p> <p>When the HQ server stops, it will automatically remove all allocation queues and cleanup all allocations.</p> <h2 id=debugging-automatic-allocation>Debugging automatic allocation<a class=headerlink href=#debugging-automatic-allocation title="Permanent link">#</a></h2> <p>Since the automatic allocator is a "background" process that interacts with an external job manager, it can be challenging to debug its behavior. To aid with this process, HyperQueue provides a "dry-run" command that you can use to test allocation parameters. HyperQueue also provides various sources of information that can help you find out what is going on.</p> <h3 id=dry-run-command>Dry-run command<a class=headerlink href=#dry-run-command title="Permanent link">#</a></h3> <p>To test whether PBS/Slurm will accept the submit parameters that you provide to the auto allocator, you can use the <code>dry-run</code> command. It accepts the same parameters as <code>hq alloc add</code>, which it will use to immediately submit an allocation and print any encountered errors.</p> <div class=highlight><pre><span></span><code>$ hq alloc dry-run pbs --timelimit 2h -- q qexp -A Project1
</code></pre></div> <p>If the allocation was submitted successfully, it will be canceled immediately to avoid wasting resources.</p> <h3 id=finding-information-about-allocations>Finding information about allocations<a class=headerlink href=#finding-information-about-allocations title="Permanent link">#</a></h3> <ul> <li><strong><a href=#display-information-about-an-allocation-queue><code>Basic queue information</code></a></strong> This command will show you details about allocations created by the automatic allocator.</li> <li><strong><a href=#display-events-of-an-allocation-queue><code>Allocator events</code></a></strong> Each time the allocator performs some action or notices that a status of some allocation was changed, it will create a corresponding event. You can use this command to list most recent events to see what was the allocator doing.</li> <li> <p><strong>Extended logging</strong> To get more information about what is happening inside the allocator, start the HyperQueue <a href=../server/ >server</a> with the following environment variable:</p> <div class=highlight><pre><span></span><code>$ <span class=nv>RUST_LOG</span><span class=o>=</span>hyperqueue::server::autoalloc<span class=o>=</span>debug hq server start
</code></pre></div> <p>The log output of the server will then contain a detailed trace of allocator actions.</p> </li> <li> <p><strong>Allocation files</strong> Each time the allocator queues an allocation into the job manager, it will write the submitted bash script, allocation ID and <code>stdout</code> and <code>stderr</code> of the allocation to disk. You can find these files inside the server directory:</p> <div class=highlight><pre><span></span><code>$ ls &lt;hq-server-dir&gt;/hq-current/autoalloc/&lt;queue-id&gt;/&lt;allocation-num&gt;/
stderr
stdout
job-id
hq-submit.sh
</code></pre></div> </li> </ul> <h2 id=useful-autoalloc-commands>Useful autoalloc commands<a class=headerlink href=#useful-autoalloc-commands title="Permanent link">#</a></h2> <p>Here is a list of useful commands to manage automatic allocation:</p> <h3 id=display-a-list-of-all-allocation-queues>Display a list of all allocation queues<a class=headerlink href=#display-a-list-of-all-allocation-queues title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code>$ hq alloc list
</code></pre></div> <h3 id=display-information-about-an-allocation-queue>Display information about an allocation queue<a class=headerlink href=#display-information-about-an-allocation-queue title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code>$ hq alloc info &lt;queue-id&gt;
</code></pre></div> <p>You can filter allocations by their state (<code>queued</code>, <code>running</code>, <code>finished</code>, <code>failed</code>) using the <code>--filter</code> option.</p> <h3 id=display-events-of-an-allocation-queue>Display events of an allocation queue<a class=headerlink href=#display-events-of-an-allocation-queue title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code>$ hq alloc events &lt;queue-id&gt;
</code></pre></div> <div class=footnote> <hr> <ol> <li id=fn:1> <p>You can use various <a href=../../tips/cli-shortcuts/#duration>shortcuts</a> for the duration value.&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> </ol> </div> <hr> <div class=md-source-date> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 13, 2021</span> <br>Created: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 2, 2021</span> </small> </div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../worker/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Workers" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Workers </div> </div> </a> <a href=../../jobs/jobs/ class="md-footer__link md-footer__link--next" aria-label="Next: Jobs and Tasks" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Jobs and Tasks </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["header.autohide", "navigation.instant", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.e99e714c.min.js", "version": {"provider": "mike", "default": "stable"}}</script> <script src=../../assets/javascripts/bundle.bc35569b.min.js></script> </body> </html>