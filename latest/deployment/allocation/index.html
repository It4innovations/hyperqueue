<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation of HyperQueue."><meta name=author content="Ada Böhm, Jakub Beránek"><link href=https://it4innovations.github.io/hyperqueue/stable/deployment/allocation/ rel=canonical><link href=../worker/ rel=prev><link href=../cloud/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>Automatic Allocation - HyperQueue</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-TM8J8R5GJ9"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-TM8J8R5GJ9",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-TM8J8R5GJ9",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#allocation-queue class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the current stable version. <a href=../../..> <b>Click here to go to the stable version.</b> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=HyperQueue class="md-header__button md-logo" aria-label=HyperQueue data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> HyperQueue </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Automatic Allocation </span> </div> </div> </div> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/It4innovations/hyperqueue title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=HyperQueue class="md-nav__button md-logo" aria-label=HyperQueue data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> HyperQueue </label> <div class=md-nav__source> <a href=https://github.com/It4innovations/hyperqueue title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../quickstart/ class=md-nav__link> <span class=md-ellipsis> Quickstart </span> </a> </li> <li class=md-nav__item> <a href=../../cheatsheet/ class=md-nav__link> <span class=md-ellipsis> Cheatsheet </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Examples </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../examples/ class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=../../examples/data-arrays/ class=md-nav__link> <span class=md-ellipsis> Processing data arrays </span> </a> </li> <li class=md-nav__item> <a href=../../examples/iterative-computation/ class=md-nav__link> <span class=md-ellipsis> Iterative computation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Deployment </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Deployment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../server/ class=md-nav__link> <span class=md-ellipsis> Server </span> </a> </li> <li class=md-nav__item> <a href=../worker/ class=md-nav__link> <span class=md-ellipsis> Workers </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Automatic Allocation </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Automatic Allocation </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#allocation-queue class=md-nav__link> <span class=md-ellipsis> Allocation queue </span> </a> <nav class=md-nav aria-label="Allocation queue"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parameters class=md-nav__link> <span class=md-ellipsis> Parameters </span> </a> <nav class=md-nav aria-label=Parameters> <ul class=md-nav__list> <li class=md-nav__item> <a href=#time-limit class=md-nav__link> <span class=md-ellipsis> Time limit </span> </a> </li> <li class=md-nav__item> <a href=#backlog class=md-nav__link> <span class=md-ellipsis> Backlog </span> </a> </li> <li class=md-nav__item> <a href=#maximum-number-of-workers-per-allocation class=md-nav__link> <span class=md-ellipsis> Maximum number of workers per allocation </span> </a> </li> <li class=md-nav__item> <a href=#maximum-worker-count class=md-nav__link> <span class=md-ellipsis> Maximum worker count </span> </a> </li> <li class=md-nav__item> <a href=#minimal-utilization class=md-nav__link> <span class=md-ellipsis> Minimal utilization </span> </a> </li> <li class=md-nav__item> <a href=#worker-resources class=md-nav__link> <span class=md-ellipsis> Worker resources </span> </a> </li> <li class=md-nav__item> <a href=#idle-timeout class=md-nav__link> <span class=md-ellipsis> Idle timeout </span> </a> </li> <li class=md-nav__item> <a href=#worker-start-command class=md-nav__link> <span class=md-ellipsis> Worker start command </span> </a> </li> <li class=md-nav__item> <a href=#worker-stop-command class=md-nav__link> <span class=md-ellipsis> Worker stop command </span> </a> </li> <li class=md-nav__item> <a href=#worker-wrap-command class=md-nav__link> <span class=md-ellipsis> Worker wrap command </span> </a> </li> <li class=md-nav__item> <a href=#worker-time-limit class=md-nav__link> <span class=md-ellipsis> Worker time limit </span> </a> </li> <li class=md-nav__item> <a href=#name class=md-nav__link> <span class=md-ellipsis> Name </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#automatic-dry-run-submission class=md-nav__link> <span class=md-ellipsis> Automatic dry-run submission </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#behavior class=md-nav__link> <span class=md-ellipsis> Behavior </span> </a> <nav class=md-nav aria-label=Behavior> <ul class=md-nav__list> <li class=md-nav__item> <a href=#rate-limits class=md-nav__link> <span class=md-ellipsis> Rate limits </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pausing-automatic-allocation class=md-nav__link> <span class=md-ellipsis> Pausing automatic allocation </span> </a> </li> <li class=md-nav__item> <a href=#stopping-automatic-allocation class=md-nav__link> <span class=md-ellipsis> Stopping automatic allocation </span> </a> </li> <li class=md-nav__item> <a href=#debugging-automatic-allocation class=md-nav__link> <span class=md-ellipsis> Debugging automatic allocation </span> </a> <nav class=md-nav aria-label="Debugging automatic allocation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dry-run-command class=md-nav__link> <span class=md-ellipsis> Dry-run command </span> </a> </li> <li class=md-nav__item> <a href=#finding-information-about-allocations class=md-nav__link> <span class=md-ellipsis> Finding information about allocations </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#useful-autoalloc-commands class=md-nav__link> <span class=md-ellipsis> Useful autoalloc commands </span> </a> <nav class=md-nav aria-label="Useful autoalloc commands"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#display-a-list-of-all-allocation-queues class=md-nav__link> <span class=md-ellipsis> Display a list of all allocation queues </span> </a> </li> <li class=md-nav__item> <a href=#display-information-about-an-allocation-queue class=md-nav__link> <span class=md-ellipsis> Display information about an allocation queue </span> </a> </li> <li class=md-nav__item> <a href=#display-stdoutstderr-output-of-an-allocation class=md-nav__link> <span class=md-ellipsis> Display stdout/stderr output of an allocation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../cloud/ class=md-nav__link> <span class=md-ellipsis> Without Shared Filesystem </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Task computation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Task computation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jobs/jobs/ class=md-nav__link> <span class=md-ellipsis> Jobs and Tasks </span> </a> </li> <li class=md-nav__item> <a href=../../jobs/arrays/ class=md-nav__link> <span class=md-ellipsis> Task Arrays </span> </a> </li> <li class=md-nav__item> <a href=../../jobs/resources/ class=md-nav__link> <span class=md-ellipsis> Resources </span> </a> </li> <li class=md-nav__item> <a href=../../jobs/cresources/ class=md-nav__link> <span class=md-ellipsis> CPU Resources </span> </a> </li> <li class=md-nav__item> <a href=../../jobs/failure/ class=md-nav__link> <span class=md-ellipsis> Handling Failure </span> </a> </li> <li class=md-nav__item> <a href=../../jobs/streaming/ class=md-nav__link> <span class=md-ellipsis> Output Streaming </span> </a> </li> <li class=md-nav__item> <a href=../../jobs/directives/ class=md-nav__link> <span class=md-ellipsis> Directives </span> </a> </li> <li class=md-nav__item> <a href=../../jobs/jobfile/ class=md-nav__link> <span class=md-ellipsis> Job Definition File </span> </a> </li> <li class=md-nav__item> <a href=../../jobs/openjobs/ class=md-nav__link> <span class=md-ellipsis> Open jobs </span> </a> </li> <li class=md-nav__item> <a href=../../jobs/multinode/ class=md-nav__link> <span class=md-ellipsis> Multinode Tasks </span> </a> </li> <li class=md-nav__item> <a href=../../jobs/explain/ class=md-nav__link> <span class=md-ellipsis> Explain command </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> CLI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> CLI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cli/dashboard/ class=md-nav__link> <span class=md-ellipsis> Dashboard </span> </a> </li> <li class=md-nav__item> <a href=../../cli/shortcuts/ class=md-nav__link> <span class=md-ellipsis> Shortcuts </span> </a> </li> <li class=md-nav__item> <a href=../../cli/output-mode/ class=md-nav__link> <span class=md-ellipsis> Output mode </span> </a> </li> <li class=md-nav__item> <a href=../../cli/documentation/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class=md-nav__item> <a href=../../cli/shell-completion/ class=md-nav__link> <span class=md-ellipsis> Shell completion </span> </a> </li> <li class=md-nav__item> <a href=../../cli-reference/ class=md-nav__link> <span class=md-ellipsis> CLI reference </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Python API </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Python API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../python/ class=md-nav__link> <span class=md-ellipsis> Getting started </span> </a> </li> <li class=md-nav__item> <a href=../../python/client/ class=md-nav__link> <span class=md-ellipsis> Client </span> </a> </li> <li class=md-nav__item> <a href=../../python/submit/ class=md-nav__link> <span class=md-ellipsis> Submitting jobs </span> </a> </li> <li class=md-nav__item> <a href=../../python/dependencies/ class=md-nav__link> <span class=md-ellipsis> Dependencies </span> </a> </li> <li class=md-nav__item> <a href=../../python/apidoc/ class=md-nav__link> <span class=md-ellipsis> API reference </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> <li class=md-nav__item> <a href=../../faq/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../../other-tools/ class=md-nav__link> <span class=md-ellipsis> Comparison With Other Tools </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#allocation-queue class=md-nav__link> <span class=md-ellipsis> Allocation queue </span> </a> <nav class=md-nav aria-label="Allocation queue"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parameters class=md-nav__link> <span class=md-ellipsis> Parameters </span> </a> <nav class=md-nav aria-label=Parameters> <ul class=md-nav__list> <li class=md-nav__item> <a href=#time-limit class=md-nav__link> <span class=md-ellipsis> Time limit </span> </a> </li> <li class=md-nav__item> <a href=#backlog class=md-nav__link> <span class=md-ellipsis> Backlog </span> </a> </li> <li class=md-nav__item> <a href=#maximum-number-of-workers-per-allocation class=md-nav__link> <span class=md-ellipsis> Maximum number of workers per allocation </span> </a> </li> <li class=md-nav__item> <a href=#maximum-worker-count class=md-nav__link> <span class=md-ellipsis> Maximum worker count </span> </a> </li> <li class=md-nav__item> <a href=#minimal-utilization class=md-nav__link> <span class=md-ellipsis> Minimal utilization </span> </a> </li> <li class=md-nav__item> <a href=#worker-resources class=md-nav__link> <span class=md-ellipsis> Worker resources </span> </a> </li> <li class=md-nav__item> <a href=#idle-timeout class=md-nav__link> <span class=md-ellipsis> Idle timeout </span> </a> </li> <li class=md-nav__item> <a href=#worker-start-command class=md-nav__link> <span class=md-ellipsis> Worker start command </span> </a> </li> <li class=md-nav__item> <a href=#worker-stop-command class=md-nav__link> <span class=md-ellipsis> Worker stop command </span> </a> </li> <li class=md-nav__item> <a href=#worker-wrap-command class=md-nav__link> <span class=md-ellipsis> Worker wrap command </span> </a> </li> <li class=md-nav__item> <a href=#worker-time-limit class=md-nav__link> <span class=md-ellipsis> Worker time limit </span> </a> </li> <li class=md-nav__item> <a href=#name class=md-nav__link> <span class=md-ellipsis> Name </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#automatic-dry-run-submission class=md-nav__link> <span class=md-ellipsis> Automatic dry-run submission </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#behavior class=md-nav__link> <span class=md-ellipsis> Behavior </span> </a> <nav class=md-nav aria-label=Behavior> <ul class=md-nav__list> <li class=md-nav__item> <a href=#rate-limits class=md-nav__link> <span class=md-ellipsis> Rate limits </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pausing-automatic-allocation class=md-nav__link> <span class=md-ellipsis> Pausing automatic allocation </span> </a> </li> <li class=md-nav__item> <a href=#stopping-automatic-allocation class=md-nav__link> <span class=md-ellipsis> Stopping automatic allocation </span> </a> </li> <li class=md-nav__item> <a href=#debugging-automatic-allocation class=md-nav__link> <span class=md-ellipsis> Debugging automatic allocation </span> </a> <nav class=md-nav aria-label="Debugging automatic allocation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dry-run-command class=md-nav__link> <span class=md-ellipsis> Dry-run command </span> </a> </li> <li class=md-nav__item> <a href=#finding-information-about-allocations class=md-nav__link> <span class=md-ellipsis> Finding information about allocations </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#useful-autoalloc-commands class=md-nav__link> <span class=md-ellipsis> Useful autoalloc commands </span> </a> <nav class=md-nav aria-label="Useful autoalloc commands"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#display-a-list-of-all-allocation-queues class=md-nav__link> <span class=md-ellipsis> Display a list of all allocation queues </span> </a> </li> <li class=md-nav__item> <a href=#display-information-about-an-allocation-queue class=md-nav__link> <span class=md-ellipsis> Display information about an allocation queue </span> </a> </li> <li class=md-nav__item> <a href=#display-stdoutstderr-output-of-an-allocation class=md-nav__link> <span class=md-ellipsis> Display stdout/stderr output of an allocation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/It4innovations/hyperqueue/blob/main/docs/deployment/allocation.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <h1>Automatic Allocation</h1> <p><strong>Automatic allocation</strong> is one of the core features of HyperQueue. When you run HyperQueue on an HPC cluster, it allows you to autonomously ask the allocation manager (PBS/Slurm) for computing resources and spawn HyperQueue <a href=../worker/ >workers</a> on the provided nodes.</p> <p>Using this mechanism, you can submit computations into HyperQueue without caring about the underlying PBS/Slurm allocations.</p> <div class="admonition note"> <p class=admonition-title>Job vs allocation terminology</p> <p>It is common to use the term "job" for allocations created by an HPC allocation manager, such as PBS or Slurm, which are used to perform computations on HPC clusters. However, HyperQueue also uses the term "job" for <a href=../../jobs/jobs/ >task graphs</a>.</p> <p>To differentiate between these two, we will refer to jobs created by PBS or Slurm as <code>allocations</code>. We will also refer to PBS/Slurm as an <code>allocation manager</code>.</p> </div> <h2 id=allocation-queue>Allocation queue<a class=headerlink href=#allocation-queue title="Permanent link">#</a></h2> <p>To enable automatic allocation, you have to create at least one <code>Allocation queue</code>. The queue describes a specific configuration that will be used by HyperQueue to request computing resources from the allocation manager on your behalf.</p> <p>Each allocation queue has a set of <a href=#parameters>parameters</a>. You can use them to modify the behavior of automatic allocation, but for start you can simply use the defaults. However, you will almost certainly need to specify some credentials to be able to ask for computing resources using PBS/Slurm.</p> <p>To create a new allocation queue, you can use the <a href=https://it4innovations.github.io/hyperqueue/stable/cli-reference/#hq/alloc/add/pbs><code>hq alloc add</code></a> command. Any trailing arguments (passed after <code>--</code>) will be passed verbatim directly to <code>qsub</code>/<code>sbatch</code> when requesting a new allocation.</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>PBS</label><label for=__tabbed_1_2>Slurm</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$<span class=w> </span>hq<span class=w> </span>alloc<span class=w> </span>add<span class=w> </span>pbs<span class=w> </span>--time-limit<span class=w> </span>1h<span class=w> </span>--<span class=w> </span>-qqprod<span class=w> </span>-AAccount1
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$<span class=w> </span>hq<span class=w> </span>alloc<span class=w> </span>add<span class=w> </span>slurm<span class=w> </span>--time-limit<span class=w> </span>1h<span class=w> </span>--<span class=w> </span>--partition<span class=o>=</span>p1
</code></pre></div> </div> </div> </div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Make sure that a HyperQueue server is running when you execute this command. Allocation queues are not persistent, so you have to set them up each time you (re)start the server (unless you use <a href=../server/#resuming-stoppedcrashed-server>journaling</a>).</p> </div> <p>You have to specify the <code>--time-limit</code> parameter to tell HyperQueue the walltime of the requested allocations (the upper limit on their duration). The automatic allocator will automatically pass this walltime to PBS/Slurm, along with the number of nodes that should be spawned in each allocation. Other parameters, such as project credentials, account ID, queue/partition name or the number of requested CPU or GPU cores per node have to be specified manually by the user using the trailing arguments.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The corollary of the paragraph above is that you <strong>should not</strong> pass the number of nodes that should be allocated or the allocation walltime in the trailing arguments. Instead, you can specify various <a href=#parameters>parameters</a> that tell the automatic allocator how to configure these options.</p> </div> <p>Once the queue is created, HyperQueue will start asking for allocations in order to provide computing resources (HyperQueue workers). The exact behavior of the automatic allocation process is described <a href=#behavior>below</a>. You can create multiple allocation queues, and you can even combine PBS queues with Slurm queues.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Note that the HQ server needs to have access to <code>qsub</code> or <code>sbatch</code> binaries on the node where it is executed. If you want to submit PBS/Slurm allocations on a remote cluster, you will need to use e.g. a proxy to redirect the commands to that cluster. See <a href=https://github.com/It4innovations/hyperqueue/issues/695>this issue</a> for more information. If you have a use-case for such remote PBS/Slurm allocation submission, please <a href=https://github.com/It4innovations/hyperqueue/issues>let us know</a>, as we could try to make that easier in HyperQueue if there was enough interest in it.</p> </div> <h3 id=parameters>Parameters<a class=headerlink href=#parameters title="Permanent link">#</a></h3> <p>In addition to arguments that are passed to <code>qsub</code>/<code>sbatch</code>, you can also use several other command line options when creating a new allocation queue.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> </div> <p>We recommend you to specify the worker resources that will be available on workers spawned in the given allocation queue using the <code>--cpus</code> and <code>--resource</code> flags as precisely as possible. It will help the automatic allocator create the first allocation more accurately.</p> <h4 id=time-limit>Time limit<a class=headerlink href=#time-limit title="Permanent link">#</a></h4> <ul> <li>Format<sup id=fnref3:1><a class=footnote-ref href=#fn:1>1</a></sup>: <strong><code>--time-limit &lt;duration&gt;</code></strong></li> </ul> <p>Sets the walltime of created allocations.</p> <p>This parameter is <strong>required</strong>, as HyperQueue must know the duration of the individual allocations. Make sure that you pass a time limit that does not exceed the limit of the PBS/Slurm queue that you intend to use, otherwise the allocation submissions will fail. You can use the <a href=#dry-run-command><code>dry-run</code> command</a> to debug this.</p> <p>By default, workers will use a <a href=../worker/#time-limit>time limit</a> equal to the time limit of the queue (unless overridden).</p> <div class="admonition important"> <p class=admonition-title>Important</p> </div> <p>If you specify a <a href=../../jobs/jobs/#time-management>time request</a> for a task, you should be aware that the time limit for the allocation queue <strong>should be larger than the time request</strong> if you want to run this task on workers created by this allocations queue, because it will always take some time before a worker is fully initialized. For example, if you set <code>--time-request 1h</code> when submitting a task, and <code>--time-limit 1h</code> when creating an allocation queue, this task will never get scheduled on workers from this queue, because the worker will get started with an actual time limit of e.g. <code>59m 58s</code>.</p> <h4 id=backlog>Backlog<a class=headerlink href=#backlog title="Permanent link">#</a></h4> <ul> <li>Format: <code>--backlog &lt;count&gt;</code></li> <li>Default: <code>1</code></li> </ul> <p>Maximum number of allocations that should be queued (waiting to be started) in PBS/Slurm at any given time. Has to be a positive integer.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The <strong>backlog</strong> value does not limit the number of running allocations, only the number of queued allocations.</p> </div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Do not set the <code>backlog</code> to a large number to avoid potentially overloading the allocation manager.</p> </div> <h4 id=maximum-number-of-workers-per-allocation>Maximum number of workers per allocation<a class=headerlink href=#maximum-number-of-workers-per-allocation title="Permanent link">#</a></h4> <ul> <li>Format: <code>--max-workers-per-alloc &lt;count&gt;</code></li> <li>Default: <code>1</code></li> </ul> <p>The maximum number of workers that will be requested in each allocation. Note that if there is not enough computational demand, the automatic allocator can create allocations with a smaller number of workers.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>If you use <a href=../../jobs/multinode/ >multi-node</a> tasks, you will probably want to use this parameter to set the maximum number of workers in a queue to the size of your <a href=../../jobs/multinode/#groups>groups</a>.</p> </div> <p>Note that the number of workers always corresponds to the number of requested nodes, as the allocator always creates a single worker per node in a single allocation request.</p> <h4 id=maximum-worker-count>Maximum worker count<a class=headerlink href=#maximum-worker-count title="Permanent link">#</a></h4> <ul> <li>Format: <code>--max-worker-count &lt;count&gt;</code></li> <li>Default: unlimited</li> </ul> <p>Maximum number of workers that can be queued or running across all allocations managed by the allocation queue. The total amount of workers will be usually limited by the manager (PBS/Slurm), but you can use this parameter to make the limit smaller, for example if you also want to manage allocations outside HyperQueue.</p> <h4 id=minimal-utilization>Minimal utilization<a class=headerlink href=#minimal-utilization title="Permanent link">#</a></h4> <ul> <li>Format: <code>--min-utilization &lt;ratio&gt;</code></li> <li>Default: <code>0.0</code></li> </ul> <p>Minimal utilization can be used to avoid creating allocations if there is not enough computational demand at the moment. If the scheduler thinks that it can currently make use of <code>N</code> of worker resources (on a range of <code>0.0 - 1.0</code>) in a single allocation of this queue, <code>min-utilization</code> has to be at least <code>N</code>, otherwise the allocation will not be created.</p> <p>It has to be a floating point number between 0.0 and 1.0.</p> <p>The default minimal utilization is <code>0</code>, which means that an allocation will be created if the scheduler thinks that it can use any (non-zero) amount of resources of worker(s) in the allocation.</p> <h4 id=worker-resources>Worker resources<a class=headerlink href=#worker-resources title="Permanent link">#</a></h4> <p>You can specify <a href=../../jobs/cresources/ >CPU</a> and <a href=../../jobs/resources/ >generic</a> resources of workers spawned by the allocation queue. The name and syntax of these parameters is the same as when you create a <a href=../../jobs/resources/#worker-resources>worker manually</a>:</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>PBS</label><label for=__tabbed_2_2>Slurm</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$<span class=w> </span>hq<span class=w> </span>alloc<span class=w> </span>add<span class=w> </span>pbs<span class=w> </span>--time-limit<span class=w> </span>1h<span class=w> </span>--cpus<span class=w> </span>4x4<span class=w> </span>--resource<span class=w> </span><span class=s2>&quot;gpus/nvidia=range(1-2)&quot;</span><span class=w> </span>--<span class=w> </span>-qqprod<span class=w> </span>-AAccount1
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$<span class=w> </span>hq<span class=w> </span>alloc<span class=w> </span>add<span class=w> </span>slurm<span class=w> </span>--time-limit<span class=w> </span>1h<span class=w> </span>--cpus<span class=w> </span>4x4<span class=w> </span>--resource<span class=w> </span><span class=s2>&quot;gpus/nvidia=range(1-2)&quot;</span><span class=w> </span>--<span class=w> </span>--partition<span class=o>=</span>p1
</code></pre></div> <p>If you do not pass any resources, they will be detected automatically (same as it works with <code>hq worker start</code>).</p> </div> </div> </div> <p>As noted <a href=#parameters>above</a>, we recommend you to set these resources as precisely as possible, if you know them.</p> <h4 id=idle-timeout>Idle timeout<a class=headerlink href=#idle-timeout title="Permanent link">#</a></h4> <ul> <li>Format<sup id=fnref2:1><a class=footnote-ref href=#fn:1>1</a></sup>: <code>--idle-timeout &lt;duration&gt;</code></li> <li>Default: <code>5m</code></li> </ul> <p>Sets the <a href=../worker/#idle-timeout>idle timeout</a> for workers started by the allocation queue. We suggest that you do not use a long duration for this parameter, as it can result in wasting precious allocation time.</p> <h4 id=worker-start-command>Worker start command<a class=headerlink href=#worker-start-command title="Permanent link">#</a></h4> <ul> <li>Format: <code>--worker-start-cmd &lt;cmd&gt;</code></li> </ul> <p>Specifies a shell command that will be executed on each allocated node just before a worker is started on that node. You can use it e.g. to initialize some shared environment for the node, or to load software modules.</p> <h4 id=worker-stop-command>Worker stop command<a class=headerlink href=#worker-stop-command title="Permanent link">#</a></h4> <ul> <li>Format: <code>--worker-stop-cmd &lt;cmd&gt;</code></li> </ul> <p>Specifies a shell command that will be executed on each allocated node just after the worker stops on that node. You can use it e.g. to clean up a previously initialized environment for the node.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The execution of this command is best-effort! It is not guaranteed that the command will always be executed. For example, PBS/Slurm can kill the allocation without giving HQ a chance to run the command.</p> </div> <h4 id=worker-wrap-command>Worker wrap command<a class=headerlink href=#worker-wrap-command title="Permanent link">#</a></h4> <ul> <li>Format: <code>--worker-wrap-cmd &lt;cmds&gt;</code></li> </ul> <p>Specifies a string that will be prepended before the command used to start a worker on a node inside an allocation.</p> <p>For example, if you specify <code>--worker-wrap-cmd "podman run"</code>, each worker will be started using <code>podman run hq worker start ...</code>.</p> <h4 id=worker-time-limit>Worker time limit<a class=headerlink href=#worker-time-limit title="Permanent link">#</a></h4> <ul> <li>Format<sup id=fnref:1><a class=footnote-ref href=#fn:1>1</a></sup>: <code>--worker-time-limit &lt;duration&gt;</code></li> </ul> <p>Sets the time limit of workers spawned by the allocation queue. After the time limit expires, the worker will be stopped. By default, the worker time limit is set to the time limit of the allocation queue. But if you want, you can shorten it with this flag to make the worker exit sooner, for example to give more time for a <a href=#worker-stop-command>worker stop command</a> to execute.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This command is not designed to stop workers early if they have nothing to do. This functionality is provided by <a href=#idle-timeout>idle timeout</a>.</p> </div> <h4 id=name>Name<a class=headerlink href=#name title="Permanent link">#</a></h4> <ul> <li>Format: <code>--name &lt;name&gt;</code></li> </ul> <p>Name of the allocation queue. It will be used to name allocations submitted to the allocation manager. Serves for debug purposes only.</p> <h3 id=automatic-dry-run-submission>Automatic dry-run submission<a class=headerlink href=#automatic-dry-run-submission title="Permanent link">#</a></h3> <p>Once you create an allocation queue, HyperQueue will first automatically create a test "dry run" allocation, to make sure that PBS/Slurm accepts the arguments that you have passed to the <code>hq alloc add</code> command. This allocation will be created in a suspended mode and it will be then immediately cancelled, so that it does not consume any resources.</p> <p>You can disable this behavior using the <code>--no-dry-run</code> flag when running <code>hq alloc add</code>.</p> <p>You can also create a dry-run submission <a href=#dry-run-command>manually</a>.</p> <h2 id=behavior>Behavior<a class=headerlink href=#behavior title="Permanent link">#</a></h2> <p>The (automatic) allocator submits allocations into PBS/Slurm based on current computational demand. When an allocation starts, a HyperQueue <a href=../worker/ >worker</a> will start and connect to the HyperQueue server that queued the allocation. The worker has the <a href=../worker/#idle-timeout>idle timeout</a> set to five minutes, so it will terminate if it doesn't receive any new tasks for five minutes.</p> <p>The allocator coordinates with the HyperQueue scheduler to figure out how many workers (and allocations) are needed to execute tasks that are currently waiting for computational resources. To determine that, the allocator needs to know the exact resources provided by workers that connect from allocations spawned by a given allocation queue. Because we cannot know these resources exactly until the first worker connects, the allocator can behave slightly differently before the first worker from a given allocation queue connects.</p> <p>For example, assume that you have specified that workers in a given queue will have <code>4</code> CPU cores (using <code>--cpus 4</code> when running <code>hq alloc add</code>). Here are a few scenarios for which we show how would the allocator behave:</p> <ul> <li>If we have waiting tasks that require <code>8</code> cores, no allocation will be submitted, because workers from this queue definitely cannot compute these tasks.</li> <li>If we have waiting tasks that require <code>2</code> cores, the allocator knows that workers from this queue will be able to compute them, so it will submit as many allocations are required to compute these tasks (based on <a href=#backlog>backlog</a> and other limits).</li> <li>If we have waiting tasks that require <code>2</code> cores and <code>1</code> GPU, the allocator will first submit a single allocation, because it is possible that the spawned worker will have a GPU (which just wasn't explicitly specified by the user in <code>hq alloc add</code>). Then:<ul> <li>If the connected worker has a GPU available, the allocator will submit further allocations for these waiting tasks.</li> <li>If the connected worker doesn't have a GPU available, the allocator will not submit further allocations to compute tasks that require a GPU.</li> </ul> </li> </ul> <h3 id=rate-limits>Rate limits<a class=headerlink href=#rate-limits title="Permanent link">#</a></h3> <p>The allocator internally uses rate limiting to avoid overloading the PBS/Slurm allocation manager by spawning too many allocations too quickly.</p> <p>It also uses additional safety limits. If <code>10</code> allocations in a succession fail to be submitted or if <code>3</code> allocations that were submitted fail to start in a succession, the corresponding allocation queue will be automatically <a href=#pausing-automatic-allocation>paused</a>.</p> <h2 id=pausing-automatic-allocation>Pausing automatic allocation<a class=headerlink href=#pausing-automatic-allocation title="Permanent link">#</a></h2> <p>If you want to pause the submission of new allocations from a given allocation queue, without removing the queue completely, you can use the <a href=https://it4innovations.github.io/hyperqueue/stable/cli-reference/#hq/alloc/pause><code>hq alloc pause</code></a> command.</p> <p>If you later want to resume allocation submission, you can use the <a href=https://it4innovations.github.io/hyperqueue/stable/cli-reference/#hq/alloc/resume><code>hq alloc resume</code></a> command.</p> <h2 id=stopping-automatic-allocation>Stopping automatic allocation<a class=headerlink href=#stopping-automatic-allocation title="Permanent link">#</a></h2> <p>If you want to remove an allocation queue, use the <a href=https://it4innovations.github.io/hyperqueue/stable/cli-reference/#hq/alloc/remove><code>hq alloc remove</code></a> command:</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>hq<span class=w> </span>alloc<span class=w> </span>remove<span class=w> </span>&lt;queue-id&gt;
</code></pre></div> <p>When an allocation queue is removed, its queued and running allocations will be canceled immediately.</p> <p>By default, HQ will not allow you to remove an allocation queue that contains a running allocation. If you want to force its removal, use the <code>--force</code> flag.</p> <p>When the HQ server stops, it will automatically remove all allocation queues and cleanup all allocations.</p> <h2 id=debugging-automatic-allocation>Debugging automatic allocation<a class=headerlink href=#debugging-automatic-allocation title="Permanent link">#</a></h2> <p>Since the automatic allocator is a "background" process that interacts with an external allocation manager, it can be challenging to debug its behavior. To aid with this process, HyperQueue provides a dry-run allocation test and also various sources of information that can help you figuring out what is going on.</p> <h3 id=dry-run-command>Dry-run command<a class=headerlink href=#dry-run-command title="Permanent link">#</a></h3> <p>To test whether PBS/Slurm will accept the submit parameters that you provide to the auto allocator without creating an allocation queue, you can use the <a href=https://it4innovations.github.io/hyperqueue/stable/cli-reference/#hq/alloc/dry-run><code>hq alloc dry-run</code></a> command. It accepts the same parameters as <a href=https://it4innovations.github.io/hyperqueue/stable/cli-reference/#hq/alloc/add/pbs><code>hq alloc add</code></a>, which it will use to immediately submit an allocation and print any encountered errors.</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>hq<span class=w> </span>alloc<span class=w> </span>dry-run<span class=w> </span>pbs<span class=w> </span>--timelimit<span class=w> </span>2h<span class=w> </span>--<span class=w> </span>q<span class=w> </span>qexp<span class=w> </span>-A<span class=w> </span>Project1
</code></pre></div> <p>If the allocation was submitted successfully, it will be canceled immediately to avoid wasting resources.</p> <h3 id=finding-information-about-allocations>Finding information about allocations<a class=headerlink href=#finding-information-about-allocations title="Permanent link">#</a></h3> <ul> <li><strong><a href=#display-information-about-an-allocation-queue><code>Basic queue information</code></a></strong> This command will show you details about allocations created by the automatic allocator.</li> <li> <p><strong>Extended logging</strong> To get more information about what is happening inside the allocator, start the HyperQueue <a href=../server/ >server</a> with the following environment variable:</p> <div class=highlight><pre><span></span><code>$<span class=w> </span><span class=nv>RUST_LOG</span><span class=o>=</span>hyperqueue::server::autoalloc<span class=o>=</span>debug<span class=w> </span>hq<span class=w> </span>server<span class=w> </span>start
</code></pre></div> </li> </ul> <p>The log output of the server will then contain a detailed trace of allocator actions.</p> <ul> <li> <p><strong>Allocation files</strong> Each time the allocator submits an allocation into the allocation manager, it will write the submitted bash script, allocation ID and <code>stdout</code> and <code>stderr</code> of the allocation to disk. You can find these files inside the server directory:</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>ls<span class=w> </span>&lt;hq-server-dir&gt;/hq-current/autoalloc/&lt;queue-id&gt;/&lt;allocation-num&gt;/
stderr
stdout
job-id
hq-submit.sh
</code></pre></div> </li> </ul> <p>You can output the contents of the <code>stdout</code> and <code>stderr</code> files of an allocation using the <a href=https://it4innovations.github.io/hyperqueue/stable/cli-reference/#hq/alloc/log><code>hq alloc log</code></a> command.</p> <h2 id=useful-autoalloc-commands>Useful autoalloc commands<a class=headerlink href=#useful-autoalloc-commands title="Permanent link">#</a></h2> <p>Below you can find a list of useful automatic allocation commands. The complete <code>hq alloc</code> CLI reference can be found <a href=https://it4innovations.github.io/hyperqueue/stable/cli-reference/#hq/alloc>here</a>.</p> <h3 id=display-a-list-of-all-allocation-queues>Display a list of all allocation queues<a class=headerlink href=#display-a-list-of-all-allocation-queues title="Permanent link">#</a></h3> <p>The <a href=https://it4innovations.github.io/hyperqueue/stable/cli-reference/#hq/alloc/list><code>hq alloc list</code></a> command will show basic information about all allocation queues.</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>hq<span class=w> </span>alloc<span class=w> </span>list
</code></pre></div> <h3 id=display-information-about-an-allocation-queue>Display information about an allocation queue<a class=headerlink href=#display-information-about-an-allocation-queue title="Permanent link">#</a></h3> <p>The <a href=https://it4innovations.github.io/hyperqueue/stable/cli-reference/#hq/alloc/info><code>hq alloc info</code></a> command will show allocations in the selected allocation queue.</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>hq<span class=w> </span>alloc<span class=w> </span>info<span class=w> </span>&lt;queue-id&gt;
</code></pre></div> <p>You can filter allocations by their state (<code>queued</code>, <code>running</code>, <code>finished</code>, <code>failed</code>) using the <code>--filter</code> option.</p> <h3 id=display-stdoutstderr-output-of-an-allocation>Display stdout/stderr output of an allocation<a class=headerlink href=#display-stdoutstderr-output-of-an-allocation title="Permanent link">#</a></h3> <p>The <a href=https://it4innovations.github.io/hyperqueue/stable/cli-reference/#hq/alloc/log><code>hq alloc log</code></a> command will print the stdout/stderr output of a specific allocation. It can be used to debug allocation errors (e.g. some PBS/Slurm problems) or the output of workers spawned in allocations.</p> <div class=highlight><pre><span></span><code>$<span class=w> </span>hq<span class=w> </span>alloc<span class=w> </span>log<span class=w> </span>&lt;allocation-id&gt;<span class=w> </span>&lt;stdout/stderr&gt;
</code></pre></div> <div class=footnote> <hr> <ol> <li id=fn:1> <p>You can use various <a href=../../cli/shortcuts/#duration>shortcuts</a> for the duration value.&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a><a class=footnote-backref href=#fnref2:1 title="Jump back to footnote 1 in the text">&#8617;</a><a class=footnote-backref href=#fnref3:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> </ol> </div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="August 7, 2025 09:26:17 UTC">August 7, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="November 2, 2021 10:37:14 UTC">November 2, 2021</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../worker/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Workers"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Workers </div> </div> </a> <a href=../cloud/ class="md-footer__link md-footer__link--next" aria-label="Next: Without Shared Filesystem"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Without Shared Filesystem </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["header.autohide", "navigation.instant", "navigation.top", "navigation.footer", "content.action.edit", "content.code.copy"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.13a4f30d.min.js></script> </body> </html>