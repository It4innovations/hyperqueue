<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation of HyperQueue."><meta name=author content="Stanislav Böhm, Jakub Beránek"><link href=https://it4innovations.github.io/hyperqueue/stable/jobs/cresources/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-7.3.2"><title>CPU Resources - HyperQueue</title><link rel=stylesheet href=../../assets/stylesheets/main.24c991ad.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TM8J8R5GJ9"),document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof location$&&location$.subscribe(function(t){gtag("config","G-TM8J8R5GJ9",{page_path:t.pathname})})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TM8J8R5GJ9"></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#requesting-more-cpus class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=HyperQueue class="md-header__button md-logo" aria-label=HyperQueue data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> HyperQueue </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> CPU Resources </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/It4innovations/hyperqueue/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=HyperQueue class="md-nav__button md-logo" aria-label=HyperQueue data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> HyperQueue </label> <div class=md-nav__source> <a href=https://github.com/It4innovations/hyperqueue/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../installation/ class=md-nav__link> Installation </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../quickstart/ class=md-nav__link> Quickstart </a> </li> <li class=md-nav__item> <a href=../../cheatsheet/ class=md-nav__link> Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Deployment <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Deployment data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Deployment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../deployment/ class=md-nav__link> Architecture </a> </li> <li class=md-nav__item> <a href=../../deployment/server/ class=md-nav__link> Server </a> </li> <li class=md-nav__item> <a href=../../deployment/worker/ class=md-nav__link> Workers </a> </li> <li class=md-nav__item> <a href=../../deployment/allocation/ class=md-nav__link> Automatic Allocation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> Task computation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Task computation" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Task computation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../jobs/ class=md-nav__link> Jobs and Tasks </a> </li> <li class=md-nav__item> <a href=../arrays/ class=md-nav__link> Task Arrays </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> CPU Resources <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> CPU Resources </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#requesting-more-cpus class=md-nav__link> Requesting more CPUs </a> </li> <li class=md-nav__item> <a href=#requesting-all-cpus class=md-nav__link> Requesting all CPUs </a> </li> <li class=md-nav__item> <a href=#cpu-related-environment-variables class=md-nav__link> CPU related environment variables </a> </li> <li class=md-nav__item> <a href=#pinning class=md-nav__link> Pinning </a> <nav class=md-nav aria-label=Pinning> <ul class=md-nav__list> <li class=md-nav__item> <a href=#automatic-pinning class=md-nav__link> Automatic pinning </a> </li> <li class=md-nav__item> <a href=#manual-pinning class=md-nav__link> Manual pinning </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#binbash class=md-nav__link> !/bin/bash </a> </li> <li class=md-nav__item> <a href=#binbash_1 class=md-nav__link> !/bin/bash </a> <nav class=md-nav aria-label=!/bin/bash> <ul class=md-nav__list> <li class=md-nav__item> <a href=#numa-allocation-policy class=md-nav__link> NUMA allocation policy </a> </li> <li class=md-nav__item> <a href=#cpu-requests-and-job-arrays class=md-nav__link> CPU requests and job arrays </a> </li> <li class=md-nav__item> <a href=#cpus-configuration class=md-nav__link> CPUs configuration </a> <nav class=md-nav aria-label="CPUs configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#manual-specification-of-cpu-configuration class=md-nav__link> Manual specification of CPU configuration </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../gresources/ class=md-nav__link> Generic Resources </a> </li> <li class=md-nav__item> <a href=../failure/ class=md-nav__link> Handling Failure </a> </li> <li class=md-nav__item> <a href=../streaming/ class=md-nav__link> Output Streaming </a> </li> <li class=md-nav__item> <a href=../directives/ class=md-nav__link> Directives </a> </li> <li class=md-nav__item> <a href=../multinode/ class=md-nav__link> Multinode Tasks </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> CLI <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=CLI data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> CLI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cli/shortcuts/ class=md-nav__link> Shortcuts </a> </li> <li class=md-nav__item> <a href=../../cli/output-mode/ class=md-nav__link> Output mode </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Python API <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Python API" data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Python API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../python/ class=md-nav__link> Python API </a> </li> <li class=md-nav__item> <a href=../../python/apidoc/ class=md-nav__link> API reference </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../events/ class=md-nav__link> Events </a> </li> <li class=md-nav__item> <a href=../../faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../../other-tools/ class=md-nav__link> Comparison With Other Tools </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#requesting-more-cpus class=md-nav__link> Requesting more CPUs </a> </li> <li class=md-nav__item> <a href=#requesting-all-cpus class=md-nav__link> Requesting all CPUs </a> </li> <li class=md-nav__item> <a href=#cpu-related-environment-variables class=md-nav__link> CPU related environment variables </a> </li> <li class=md-nav__item> <a href=#pinning class=md-nav__link> Pinning </a> <nav class=md-nav aria-label=Pinning> <ul class=md-nav__list> <li class=md-nav__item> <a href=#automatic-pinning class=md-nav__link> Automatic pinning </a> </li> <li class=md-nav__item> <a href=#manual-pinning class=md-nav__link> Manual pinning </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#binbash class=md-nav__link> !/bin/bash </a> </li> <li class=md-nav__item> <a href=#binbash_1 class=md-nav__link> !/bin/bash </a> <nav class=md-nav aria-label=!/bin/bash> <ul class=md-nav__list> <li class=md-nav__item> <a href=#numa-allocation-policy class=md-nav__link> NUMA allocation policy </a> </li> <li class=md-nav__item> <a href=#cpu-requests-and-job-arrays class=md-nav__link> CPU requests and job arrays </a> </li> <li class=md-nav__item> <a href=#cpus-configuration class=md-nav__link> CPUs configuration </a> <nav class=md-nav aria-label="CPUs configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#manual-specification-of-cpu-configuration class=md-nav__link> Manual specification of CPU configuration </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/It4innovations/hyperqueue/blob/main/docs/jobs/cresources.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <p><strong>Note:</strong> In this text we use term <strong>CPU</strong> as a resource that is provided by operating system (e.g. what you get from /proc/cpuinfo). In this meaning, it is usually a core of a physical CPU. In the text related to NUMA we use term <strong>socket</strong> to refer to a physical CPU.</p> <h2 id=requesting-more-cpus>Requesting more CPUs<a class=headerlink href=#requesting-more-cpus title="Permanent link">#</a></h2> <p>By default, each task allocates a single CPU on worker's node. This can be changed by argument <code>--cpus=...</code>.</p> <p>Example: Request for a job with a task that needs 8 cpus:</p> <p><code>$ hq submit --cpus=8 &lt;program_name&gt; &lt;args...&gt;</code></p> <p>This ensures that 8 cpus will be exclusively reserved when this task is started. This task will never be scheduled on a worker that has less then 8 cpus.</p> <h2 id=requesting-all-cpus>Requesting all CPUs<a class=headerlink href=#requesting-all-cpus title="Permanent link">#</a></h2> <p>Setting <code>--cpus=all</code> ensures that will request all CPUs of the worker and ensures an exclusive run of the task.</p> <p><code>$ hq submit --cpus=all &lt;program_name&gt; &lt;args...&gt;</code></p> <h2 id=cpu-related-environment-variables>CPU related environment variables<a class=headerlink href=#cpu-related-environment-variables title="Permanent link">#</a></h2> <ul> <li><code>HQ_CPUS</code> - List of cores assigned to task</li> <li><code>HQ_PIN</code> - Is set to <code>taskset</code> or <code>omp</code> (depending on the used pin mode) if the task was pinned by HyperQueue (see below).</li> <li><code>NUM_OMP_THREADS</code> -- Set to number of cores assigned for task. (For compatibility with OpenMP).</li> </ul> <h2 id=pinning>Pinning<a class=headerlink href=#pinning title="Permanent link">#</a></h2> <p>By default, HQ internally allocates CPUs on logical level without pinning. In other words, HQ ensures that the sum of requests of concurrently running tasks does not exceed the number of CPUs in the worker, but the process placement is left on the system scheduler that may move processes across CPUs as it wants.</p> <p>If this is not desired, especially in the case of NUMA, processes could be pinned, either manually or automatically.</p> <h3 id=automatic-pinning>Automatic pinning<a class=headerlink href=#automatic-pinning title="Permanent link">#</a></h3> <p>HyperQueue can pin threads using two ways: with <code>taskset</code> or by setting <code>OpenMP</code> environment variables. You can use the <code>--pin</code> flag to choose between these two modes.</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>taskset</label><label for=__tabbed_1_2>OpenMP</label></div> <div class=tabbed-content> <div class=tabbed-block> <p><code>bash $ hq submit --pin taskset --cpus=8 &lt;your-program&gt; &lt;args&gt;</code></p> <p>will cause HyperQueue to execute your program like this: <code>bash taskset -c "&lt;allocated-cores&gt;" &lt;your-program&gt; &lt;args&gt;`</code></p> </div> <div class=tabbed-block> <p><code>$ hq submit --pin omp --cpus=8 &lt;your-program&gt; &lt;args&gt;</code></p> <p>will cause HyperQueue to execute your program like this: <code>bash OMP_PROC_BIND=close OMP_PLACES="{&lt;allocated-cores&gt;}" &lt;your-program&gt; &lt;args&gt;</code></p> </div> </div> </div> <p>If any automatic pinning mode is enabled, the environment variable <code>HQ_PIN</code> will be set.</p> <h3 id=manual-pinning>Manual pinning<a class=headerlink href=#manual-pinning title="Permanent link">#</a></h3> <p>If you want to gain a full control over pinning processes, you may pin the process by yourself.</p> <p>The assigned CPUs are stored in the environment variable <code>HQ_CPUS</code> as a comma-delimited list of CPU ids. You can use utilities such as <code>taskset</code> or <code>numactl</code> and pass them <code>HQ_CPUS</code> to pin a process to these CPUs.</p> <p><strong>Warning</strong> If you manually pin your processes, do not use <code>--pin</code> flag in submit command. It may have some unwanted interferences.</p> <p>For example, you can create the following <code>script.sh</code> (with executable permission)</p> <p>```bash</p> <h1 id=binbash>!/bin/bash<a class=headerlink href=#binbash title="Permanent link">#</a></h1> <p>taskset -c $HQ_CPUS <your-program> <args...> ```</p> <p>If it is submitted as <code>$ hq submit --cpus=4 script.sh</code> It will pin your program to 4 CPUs allocated by HQ.</p> <p>In the case of <code>numactl</code>, the equivalent script would be:</p> <p>```bash</p> <h1 id=binbash_1>!/bin/bash<a class=headerlink href=#binbash_1 title="Permanent link">#</a></h1> <p>numactl -C $HQ_CPUS <your-program> <args...> ```</p> <h2 id=numa-allocation-policy>NUMA allocation policy<a class=headerlink href=#numa-allocation-policy title="Permanent link">#</a></h2> <p>HQ currently ofsers the following allocation strategies how CPUs are allocated. It can be specified by <code>--cpus</code> argument in form <code>"&lt;#cpus&gt; &lt;policy&gt;"</code>.</p> <p>Note: Specifying policy has effect only if you have more than one socket (physical CPUs). In case of a single socket, policies are indistinguishable.</p> <ul> <li>Compact (<code>compact</code>) - Tries to allocate cores on as few sockets as possible in the current worker state.</li> </ul> <p>Example: <code>hq submit --cpus="8 compact" ...</code></p> <ul> <li>Strict Compact (<code>compact!</code>) - Always allocate cores on as few sockets as possible for a target node. The task is not executed until the requirement could not be fully fullfiled. E.g. If your worker has 4 cores per socket and you ask for 4 cpus, it will be always executed on a single socket. If you ask for 8 cpus, it will be always executed on two sockets.</li> </ul> <p>Example: <code>hq submit --cpus="8 compact!" ...</code></p> <ul> <li>Scatter (<code>scatter</code>) - Allocate cores across as many sockets possible in the current worker state. If your worker has 4 sockets with 8 cores per socket and you ask for 8 cpus than if possible in the current situation, HQ tries to run process with 2 cpus on each socket.</li> </ul> <p>Example: <code>hq submit --cpus="8 scatter" ...</code></p> <p>The default policy is the compact policy, i.e. <code>--cpus=XX</code> is equivalent to <code>--cpus="XX compact"</code></p> <h2 id=cpu-requests-and-job-arrays>CPU requests and job arrays<a class=headerlink href=#cpu-requests-and-job-arrays title="Permanent link">#</a></h2> <p>Resource requests are applied to each task of job. For example, if you submit the following: <code>hq submit --cpus=2 --array=1-10</code> it will create 10 tasks where each task needs two CPUs.</p> <h2 id=cpus-configuration>CPUs configuration<a class=headerlink href=#cpus-configuration title="Permanent link">#</a></h2> <p>Worker automatically detect number of CPUs and on Linux system it also detects partitioning into sockets. In most cases, it should work without need of any touch. If you want to see how is your seen by a worker without actually starting it, you can start <code>$ hq worker hwdetect</code> that only prints CPUs layout.</p> <h3 id=manual-specification-of-cpu-configuration>Manual specification of CPU configuration<a class=headerlink href=#manual-specification-of-cpu-configuration title="Permanent link">#</a></h3> <p>If automatic detection fails, or you want to manually configure set a CPU configuration, you can use <code>--cpus</code> parameter; for example as follows:</p> <ul> <li> <p>8 CPUs for worker <code>$ hq worker start --cpus=8</code></p> </li> <li> <p>2 sockets with 12 cores per socket <code>$ hq worker start --cpus=2x12</code></p> </li> <li> <p>Automatic detection of CPUs but ignores HyperThreading (it will detect only the first virtual core of each physical core) <code>$ hq worker start --cpus="no-ht"</code></p> </li> <li> <p>Manually specify that worker should use the following core ids and how they are organized into sockets. In this example, two sockets are defined, one with 3 cores and one with 2 cores. <code>$ hq worker start --cpus=[[2, 3, 4], [10, 14]]</code></p> </li> </ul> <hr> <div class=md-source-date> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">April 7, 2022</span> <br>Created: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 7, 2021</span> </small> </div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../arrays/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Task Arrays" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Task Arrays </div> </div> </a> <a href=../gresources/ class="md-footer__link md-footer__link--next" aria-label="Next: Generic Resources" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Generic Resources </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["header.autohide", "navigation.instant", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.e99e714c.min.js", "version": {"provider": "mike", "default": "stable"}}</script> <script src=../../assets/javascripts/bundle.bc35569b.min.js></script> </body> </html>