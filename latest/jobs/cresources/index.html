<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation of HyperQueue."><meta name=author content="Stanislav Böhm, Jakub Beránek"><link href=https://it4innovations.github.io/hyperqueue/stable/jobs/cresources/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-7.3.2"><title>CPU Resources - HyperQueue</title><link rel=stylesheet href=../../assets/stylesheets/main.24c991ad.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TM8J8R5GJ9"),document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof location$&&location$.subscribe(function(t){gtag("config","G-TM8J8R5GJ9",{page_path:t.pathname})})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TM8J8R5GJ9"></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#cpu-resource-management class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=HyperQueue class="md-header__button md-logo" aria-label=HyperQueue data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> HyperQueue </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> CPU Resources </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/It4innovations/hyperqueue/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=HyperQueue class="md-nav__button md-logo" aria-label=HyperQueue data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> HyperQueue </label> <div class=md-nav__source> <a href=https://github.com/It4innovations/hyperqueue/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../installation/ class=md-nav__link> Installation </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../quickstart/ class=md-nav__link> Quickstart </a> </li> <li class=md-nav__item> <a href=../../cheatsheet/ class=md-nav__link> Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Deployment <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Deployment data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Deployment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../deployment/ class=md-nav__link> Architecture </a> </li> <li class=md-nav__item> <a href=../../deployment/server/ class=md-nav__link> Server </a> </li> <li class=md-nav__item> <a href=../../deployment/worker/ class=md-nav__link> Workers </a> </li> <li class=md-nav__item> <a href=../../deployment/allocation/ class=md-nav__link> Automatic Allocation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> Task computation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Task computation" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Task computation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../jobs/ class=md-nav__link> Jobs and Tasks </a> </li> <li class=md-nav__item> <a href=../arrays/ class=md-nav__link> Task Arrays </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> CPU Resources <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> CPU Resources </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#requesting-more-cpus class=md-nav__link> Requesting more CPUs </a> <nav class=md-nav aria-label="Requesting more CPUs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#requesting-all-cpus class=md-nav__link> Requesting all CPUs </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pinning class=md-nav__link> Pinning </a> <nav class=md-nav aria-label=Pinning> <ul class=md-nav__list> <li class=md-nav__item> <a href=#automatic-pinning class=md-nav__link> Automatic pinning </a> </li> <li class=md-nav__item> <a href=#manual-pinning class=md-nav__link> Manual pinning </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#numa-allocation-policy class=md-nav__link> NUMA allocation policy </a> </li> <li class=md-nav__item> <a href=#cpu-requests-and-task-arrays class=md-nav__link> CPU requests and task arrays </a> </li> <li class=md-nav__item> <a href=#cpu-configuration class=md-nav__link> CPU configuration </a> <nav class=md-nav aria-label="CPU configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#manual-specification-of-cpu-configuration class=md-nav__link> Manual specification of CPU configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cpu-related-environment-variables class=md-nav__link> CPU related environment variables </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../gresources/ class=md-nav__link> Generic Resources </a> </li> <li class=md-nav__item> <a href=../failure/ class=md-nav__link> Handling Failure </a> </li> <li class=md-nav__item> <a href=../streaming/ class=md-nav__link> Output Streaming </a> </li> <li class=md-nav__item> <a href=../directives/ class=md-nav__link> Directives </a> </li> <li class=md-nav__item> <a href=../multinode/ class=md-nav__link> Multinode Tasks </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> CLI <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=CLI data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> CLI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cli/shortcuts/ class=md-nav__link> Shortcuts </a> </li> <li class=md-nav__item> <a href=../../cli/output-mode/ class=md-nav__link> Output mode </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Python API <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Python API" data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Python API </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../python/ class=md-nav__link> Getting started </a> </li> <li class=md-nav__item> <a href=../../python/client/ class=md-nav__link> Client </a> </li> <li class=md-nav__item> <a href=../../python/submit/ class=md-nav__link> Submitting jobs </a> </li> <li class=md-nav__item> <a href=../../python/dependencies/ class=md-nav__link> Dependencies </a> </li> <li class=md-nav__item> <a href=../../python/apidoc/ class=md-nav__link> API reference </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../events/ class=md-nav__link> Events </a> </li> <li class=md-nav__item> <a href=../../faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../../other-tools/ class=md-nav__link> Comparison With Other Tools </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#requesting-more-cpus class=md-nav__link> Requesting more CPUs </a> <nav class=md-nav aria-label="Requesting more CPUs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#requesting-all-cpus class=md-nav__link> Requesting all CPUs </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#pinning class=md-nav__link> Pinning </a> <nav class=md-nav aria-label=Pinning> <ul class=md-nav__list> <li class=md-nav__item> <a href=#automatic-pinning class=md-nav__link> Automatic pinning </a> </li> <li class=md-nav__item> <a href=#manual-pinning class=md-nav__link> Manual pinning </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#numa-allocation-policy class=md-nav__link> NUMA allocation policy </a> </li> <li class=md-nav__item> <a href=#cpu-requests-and-task-arrays class=md-nav__link> CPU requests and task arrays </a> </li> <li class=md-nav__item> <a href=#cpu-configuration class=md-nav__link> CPU configuration </a> <nav class=md-nav aria-label="CPU configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#manual-specification-of-cpu-configuration class=md-nav__link> Manual specification of CPU configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cpu-related-environment-variables class=md-nav__link> CPU related environment variables </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/It4innovations/hyperqueue/blob/main/docs/jobs/cresources.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=cpu-resource-management>CPU resource management<a class=headerlink href=#cpu-resource-management title="Permanent link">#</a></h1> <p>HyperQueue allows you to select how many CPU cores will be allocated for each task.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>In this text, we use the term <strong>CPU</strong> for a resource that is provided by the operating system (e.g. what you get from <code>/proc/cpuinfo</code>). In this meaning, it is usually a core of a physical CPU. In the text related to NUMA we use the term <strong>socket</strong> to refer to physical CPUs.</p> </div> <h2 id=requesting-more-cpus>Requesting more CPUs<a class=headerlink href=#requesting-more-cpus title="Permanent link">#</a></h2> <p>By default, each task requires a single CPU of the worker's node. This can be changed by the flag <code>--cpus</code>.</p> <p>For example, to submit a job with a task that requires 8 CPUs:</p> <div class=highlight><pre><span></span><code>$ hq submit --cpus<span class=o>=</span><span class=m>8</span> &lt;program_name&gt; &lt;args...&gt;
</code></pre></div> <p>This ensures that HyperQueue will exclusively reserve 8 CPUs for this task when it is started. This task would thus never be scheduled on a worker that has less than 8 CPUs.</p> <p>Note that this reservation exists on a logical level only. To ensure more direct mapping to physical cores, see <a href=#pinning>pinning</a> below.</p> <h3 id=requesting-all-cpus>Requesting all CPUs<a class=headerlink href=#requesting-all-cpus title="Permanent link">#</a></h3> <p>You can also use the value <code>all</code> for the <code>--cpus</code> flag to ensure that the task will request all available CPUs of the worker where it is executed. This will make sure that there will not be any other tasks executing on the same worker at the same time.</p> <div class=highlight><pre><span></span><code>$ hq submit --cpus<span class=o>=</span>all &lt;program_name&gt; &lt;args...&gt;
</code></pre></div> <h2 id=pinning>Pinning<a class=headerlink href=#pinning title="Permanent link">#</a></h2> <p>By default, HQ internally allocates CPUs on a logical level. In other words, HQ ensures that the sum of requests of concurrently running tasks does not exceed the number of CPUs of the worker, but process assignment to cores is left to the system scheduler, which may move processes across CPUs as it wants.</p> <p>If this is not desired, especially in the case of NUMA, processes could be pinned, either manually or automatically.</p> <h3 id=automatic-pinning>Automatic pinning<a class=headerlink href=#automatic-pinning title="Permanent link">#</a></h3> <p>HyperQueue can pin threads using two ways: with <code>taskset</code> or by setting <code>OpenMP</code> environment variables. You can use the <code>--pin</code> flag to choose between these two modes.</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>taskset</label><label for=__tabbed_1_2>OpenMP</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$ hq submit --pin taskset --cpus<span class=o>=</span><span class=m>8</span> &lt;your-program&gt; &lt;args&gt;
</code></pre></div> <p>will cause HyperQueue to execute your program like this: <div class=highlight><pre><span></span><code>taskset -c <span class=s2>&quot;&lt;allocated-cores&gt;&quot;</span> &lt;your-program&gt; &lt;args&gt;<span class=sb>`</span>
</code></pre></div></p> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>$ hq submit --pin omp --cpus<span class=o>=</span><span class=m>8</span> &lt;your-program&gt; &lt;args&gt;
</code></pre></div> <p>will cause HyperQueue to execute your program like this: <div class=highlight><pre><span></span><code><span class=nv>OMP_PROC_BIND</span><span class=o>=</span>close <span class=nv>OMP_PLACES</span><span class=o>=</span><span class=s2>&quot;{&lt;allocated-cores&gt;}&quot;</span> &lt;your-program&gt; &lt;args&gt;
</code></pre></div></p> </div> </div> </div> <p>If any automatic pinning mode is enabled, the environment variable <code>HQ_PIN</code> will be set.</p> <h3 id=manual-pinning>Manual pinning<a class=headerlink href=#manual-pinning title="Permanent link">#</a></h3> <p>If you want to gain full control over core pinning, you may pin the process by yourself.</p> <p>The assigned CPUs are stored in the environment variable <code>HQ_CPUS</code> as a comma-delimited list of CPU IDs. You can use utilities such as <code>taskset</code> or <code>numactl</code> and pass them <code>HQ_CPUS</code> to pin a process to these CPUs.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>If you manually pin your processes, do not also use the <code>--pin</code> flag of the <code>submit</code> command. It may have some unwanted interferences.</p> </div> <p>Below you can find an example of a script file that pins the executed process manually using <code>taskset</code> and <code>numactl</code>:</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>taskset</label><label for=__tabbed_2_2>numactl</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=ch>#!/bin/bash</span>

taskset -c <span class=nv>$HQ_CPUS</span> &lt;your-program&gt; &lt;args...&gt;
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=ch>#!/bin/bash</span>

numactl -C <span class=nv>$HQ_CPUS</span> &lt;your-program&gt; &lt;args...&gt;
</code></pre></div> </div> </div> </div> <p>If you submit this script with <code>hq submit --cpus=4 script.sh</code>, it will pin your program to 4 CPUs allocated by HQ.</p> <h2 id=numa-allocation-policy>NUMA allocation policy<a class=headerlink href=#numa-allocation-policy title="Permanent link">#</a></h2> <p>HQ currently offers the following allocation strategies for CPUs allocation. It can be specified with the <code>--cpus</code> flag in the form <code>"&lt;#cpus&gt; &lt;policy&gt;"</code>.</p> <ul> <li> <p>Compact (<code>compact</code>) - Tries to allocate cores on as few sockets as possible, based on the currently available cores of a worker.</p> <div class=highlight><pre><span></span><code>$ hq submit --cpus<span class=o>=</span><span class=s2>&quot;8 compact&quot;</span> ...
</code></pre></div> </li> <li> <p>Strict Compact (<code>compact!</code>) - Always allocates cores on as few sockets as possible for a target node. The task will not be executed until the requirement could be fully fulfilled. For example, if your worker has 4 cores per socket, and you ask for 4 CPUs, it will always be executed on a single socket. If you ask for 8 CPUs, it will always be executed on two sockets.</p> <div class=highlight><pre><span></span><code>$ hq submit --cpus<span class=o>=</span><span class=s2>&quot;8 compact!&quot;</span> ...
</code></pre></div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>You might encounter a problem in your shell when you try to specify the strict compact policy, because the definition contains an exclamation mark (<code>!</code>). In that case, try to wrap the policy in single quotes, like this:</p> <div class=highlight><pre><span></span><code>$ hq submit --cpus<span class=o>=</span><span class=s1>&#39;8 compact!&#39;</span> ...
</code></pre></div> </div> </li> <li> <p>Scatter (<code>scatter</code>) - Allocate cores across as many sockets possible, based on the currently available cores of a worker. If your worker has 4 sockets with 8 cores per socket, and you ask for 8 CPUs, then HQ will try to run the process with 2 CPUs on each socket, if possible given the currently available worker cores.</p> <div class=highlight><pre><span></span><code>$ hq submit --cpus<span class=o>=</span><span class=s2>&quot;8 scatter&quot;</span> ...
</code></pre></div> </li> </ul> <p>The default policy is the <code>compact</code> policy, i.e. <code>--cpus=&lt;X&gt;</code> is equivalent to <code>--cpus="&lt;X&gt; compact"</code>.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Specifying policy has effect only if you have more than one socket (physical CPUs). In case of a single socket, policies are indistinguishable.</p> </div> <h2 id=cpu-requests-and-task-arrays>CPU requests and task arrays<a class=headerlink href=#cpu-requests-and-task-arrays title="Permanent link">#</a></h2> <p>Resource requests are applied to each task of job. For example, if you submit the following:</p> <div class=highlight><pre><span></span><code>$ hq submit --cpus<span class=o>=</span><span class=m>2</span> --array<span class=o>=</span><span class=m>1</span>-10
</code></pre></div> <p>it will create 10 tasks where each task needs two CPUs.</p> <h2 id=cpu-configuration>CPU configuration<a class=headerlink href=#cpu-configuration title="Permanent link">#</a></h2> <p>Each worker will automatically detect the number of CPUs available. On Linux systems, it will also detect the partitioning into sockets (NUMA configuration). In most cases, it should work out of the box. If you want to see how will a HQ worker see your CPU configuration without actually starting the worker, you can use the <code>hq worker hwdetect</code> command, which will print the detected CPU configuration.</p> <h3 id=manual-specification-of-cpu-configuration>Manual specification of CPU configuration<a class=headerlink href=#manual-specification-of-cpu-configuration title="Permanent link">#</a></h3> <p>If the automatic detection fails for some reason, or you want to manually configure the CPU configuration, you can use the <code>--cpus</code> flag when starting a worker. Below there are some examples of configuration that you can specify:</p> <ul> <li> <p>Worker with 8 CPUs and a single socket. <div class=highlight><pre><span></span><code>$ hq worker start --cpus<span class=o>=</span><span class=m>8</span>
</code></pre></div></p> </li> <li> <p>Worker with 2 sockets with 12 cores per socket. <div class=highlight><pre><span></span><code>$ hq worker start --cpus<span class=o>=</span>2x12
</code></pre></div></p> </li> <li> <p>Automatically detect CPUs, but ignore HyperThreading. It will detect only the first virtual core of each physical core. <div class=highlight><pre><span></span><code>$ hq worker start --cpus<span class=o>=</span><span class=s2>&quot;no-ht&quot;</span>
</code></pre></div></p> </li> <li> <p>Manually specify that the worker should use the following core ids and how they are organized into sockets. In this example, two sockets are defined, one with 3 cores and one with 2 cores. <div class=highlight><pre><span></span><code>$ hq worker start --cpus<span class=o>=[[</span><span class=m>2</span>, <span class=m>3</span>, <span class=m>4</span><span class=o>]</span>, <span class=o>[</span><span class=m>10</span>, <span class=m>14</span><span class=o>]]</span>
</code></pre></div></p> </li> </ul> <h2 id=cpu-related-environment-variables>CPU related environment variables<a class=headerlink href=#cpu-related-environment-variables title="Permanent link">#</a></h2> <p>Several environment variables related to CPU management will be passed to tasks executed by HyperQueue:</p> <ul> <li><code>HQ_CPUS</code> - Comma-separated list of numeric core IDs assigned to the task.</li> <li><code>HQ_PIN</code> - It is set to <code>taskset</code> or <code>omp</code> (depending on the used pinning mode) if the task was <a href=#pinning>pinned</a>.</li> <li><code>NUM_OMP_THREADS</code> - Set to the number of cores assigned for task. (For compatibility with OpenMP).</li> </ul> <hr> <div class=md-source-date> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">August 9, 2022</span> <br>Created: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 7, 2021</span> </small> </div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../arrays/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Task Arrays" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Task Arrays </div> </div> </a> <a href=../gresources/ class="md-footer__link md-footer__link--next" aria-label="Next: Generic Resources" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Generic Resources </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["header.autohide", "navigation.instant", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.e99e714c.min.js", "version": {"provider": "mike", "default": "stable"}}</script> <script src=../../assets/javascripts/bundle.bc35569b.min.js></script> </body> </html>