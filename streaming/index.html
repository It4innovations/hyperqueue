<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Stanislav BÃ¶hm">
  <link rel="canonical" href="https://it4innovations.github.io/hyperqueue/streaming/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Streaming stdio/stderr - HyperQueue</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Streaming stdio/stderr";
    var mkdocs_page_input_path = "streaming.md";
    var mkdocs_page_url = "/hyperqueue/streaming/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TM8J8R5GJ9"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }
    gtag('js', new Date());
    gtag('config', 'G-TM8J8R5GJ9');
</script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> HyperQueue</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Overview</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../install/">Installation</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../cheatsheet/">Cheatsheet</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../deployment/">Deployment</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../jobs/">Jobs (Basics)</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../arrays/">Task Arrays</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../cpus/">CPU management</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Streaming stdio/stderr</a>
    <ul class="current">
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">HyperQueue</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Streaming stdio/stderr</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/It4innovations/hyperqueue/blob/main/docs/streaming.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="streaming">Streaming<a class="headerlink" href="#streaming" title="Permanent link">#</a></h1>
<p>The main goal of streaming is to avoid creating many files when a large array job is submitted. For example
when you submit:</p>
<p><code>hq submit --array=1-10000 my-computation.sh</code></p>
<p>will create 20000 files (10000 for stdout and 10000 for stderr).</p>
<p>This can be solved by using <code>--log</code> option:</p>
<p><code>hq submit --log=&lt;LOG_FILENAME&gt; --array=1-10000 my-computation.sh</code></p>
<p>All stdout and stderr streams will be streamed into server and into a single file specified via <LOG_FILENAME>.
The streamed data is stored with additional metadata, so the resulting file can be filtered/sorted by tasks or type of stream.</p>
<h1 id="superseded-streams">Superseded streams<a class="headerlink" href="#superseded-streams" title="Permanent link">#</a></h1>
<p>It may happen that a task started a stream but the worker where the task is running crashed.
In such situation, the scheduler starts a task on another worker and it produces a new stream.
To avoid mixing outputs from different runs, HyperQueue automatically marks all previous runs as superseded and ignores them by default.</p>
<h1 id="log-summary">Log <code>summary</code><a class="headerlink" href="#log-summary" title="Permanent link">#</a></h1>
<p><code>hq log &lt;LOG_FILENAME&gt; summary</code></p>
<p>Displays summary of the log.</p>
<h1 id="log-show">Log <code>show</code><a class="headerlink" href="#log-show" title="Permanent link">#</a></h1>
<p><code>hq log &lt;LOG_FILENAME&gt; show</code> show the content of the log with metadata printed in the order how it was received by the server.</p>
<p>Prompt has form <code>X:Y&gt;</code> where X is task id and Y is 0 for stdout and 1 for stderr.</p>
<p>You can filter only stdout/stderr stream via <code>--channel=X</code> where X is <code>stdout</code> or <code>stderr</code>.</p>
<p>By default, HQ does not show closing information from streams that are empty, you can change that with the flag <code>--show-empty</code>.</p>
<p>Note: Superseded streams are completely ignored by <code>show</code> command.</p>
<h1 id="log-cat">Log <code>cat</code><a class="headerlink" href="#log-cat" title="Permanent link">#</a></h1>
<p><code>hq log &lt;LOG_FILENAME&gt; cat &lt;stdout/stderr&gt;</code></p>
<p>prints raw content of stdout or stderr ordered by task id.
All outputs are concatenated one after another.</p>
<p>By default, this command will fail if there is an unfinished stream (i.e. a task is still running). If you want to use <code>cat</code> even with running tasks, use option <code>--allow-unfinished</code>.</p>
<p>If you want to see only output of a specific task, use option <code>--task=&lt;task_id&gt;</code></p>
<p>Note: Superseded streams are completely ignored by <code>cat</code> command.</p>
<h1 id="partial-redirection">Partial redirection<a class="headerlink" href="#partial-redirection" title="Permanent link">#</a></h1>
<p>If you want to stream only one channel and redirect the other one into a file, you can still use <code>--stdout</code> / <code>--stderr</code> options.</p>
<p>Redirecting stdout into a file, stderr will be streamed into <code>my-log</code>.</p>
<p><code>hq submit --log=my-log --stdout=stdout-%{TASK_ID} ...</code></p>
<p>Disabling stderr and streaming only stdout into log file.</p>
<p><code>hq submit --log=my-log --stderr=none ...</code></p>
<h1 id="guarantees">Guarantees<a class="headerlink" href="#guarantees" title="Permanent link">#</a></h1>
<p>When a task is <em>finished</em> or <em>failed</em> (except fail of streaming, see below) then it is guaranteed that its stream is fully flushed into the log file.</p>
<p>When a task is <em>canceled</em> then the stream is not necessarily fully written into the log file in the moment when the state occurs and some parts may be written later, but the stream will be eventually closed.</p>
<p>When a task is <em>canceled</em> or the time limit is reached then part of the stream buffered in the worker is dropped to void spending additional resources for this task. In practice, this should be only part that is produced immediately before the event, because data are sent to the server as soon as possible.</p>
<p>If streaming failed (e.g. insufficient disk space for the log file) then task fails with an error prefixed "Streamer:" and no guarantees for streaming are provided.</p>
<h1 id="current-limitations">Current limitations<a class="headerlink" href="#current-limitations" title="Permanent link">#</a></h1>
<p>The current version does not support streaming of more jobs into the same file,</p>
<p>In other words, if you submit more jobs with the same log filename, like this:</p>
<pre><code>hq submit --log=my-log ...
hq submit --log=my-log ...
</code></pre>
<p>Then log will contain only data from one job and other will be overwritten.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../cpus/" class="btn btn-neutral" title="CPU management"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/It4innovations/hyperqueue/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../cpus/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
